<div class="min-h-screen flex flex-col">
  <app-admin-header />

  <main class="flex-grow relative">
    <div class="p-4 pt-10 w-full max-w-screen-md mx-auto flex flex-col gap-6">
      <!-- PROFILE -->

      <mat-card class="p-6 rounded-2xl shadow-md hover:shadow-lg transition">
        <h2
          class="text-xl font-semibold text-center mb-6 text-gray-900 dark:text-gray-200"
        >
          Profile
        </h2>

        <form
          [formGroup]="profileForm"
          (ngSubmit)="updateProfile()"
          class="flex flex-col gap-4"
        >
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- First Name -->
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>First Name</mat-label>

              <input matInput formControlName="firstName" />

              @let firstName = profileForm.controls.firstName;

              @if (firstName?.touched && firstName?.invalid) {
                <mat-error>
                  @switch (true) {
                    @case (firstName.errors?.["required"]) {
                      First name is required
                    }
                    @case (
                      firstName.errors?.["personName"]?.reason === "length"
                    ) {
                      Minimum
                      {{ firstName?.errors?.["personName"]?.minLength }}
                      characters
                    }
                    @case (
                      firstName?.errors?.["personName"]?.reason ===
                      "invalidFormat"
                    ) {
                      Only letters, spaces, apostrophes and hyphens allowed
                    }
                  }
                </mat-error>
              }
            </mat-form-field>

            <!-- Last Name -->
            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Last Name</mat-label>

              <input matInput formControlName="lastName" />

              @let lastName = profileForm.controls.lastName;

              @if (lastName?.touched && lastName?.invalid) {
                <mat-error>
                  @switch (true) {
                    @case (lastName.errors?.["required"]) {
                      Last name is required
                    }
                    @case (
                      lastName.errors?.["personName"]?.reason === "length"
                    ) {
                      Minimum
                      {{ lastName?.errors?.["personName"]?.minLength }}
                      characters
                    }
                    @case (
                      lastName?.errors?.["personName"]?.reason ===
                      "invalidFormat"
                    ) {
                      Only letters, spaces, apostrophes and hyphens allowed
                    }
                  }
                </mat-error>
              }
            </mat-form-field>
          </div>

          <button
            mat-flat-button
            color="primary"
            type="submit"
            class="rounded-xl shadow-md mt-4 dark:bg-blue-700 dark:text-white"
            [disabled]="profileForm.invalid || isProfileSubmitting"
          >
            Save Changes
          </button>
        </form>
      </mat-card>

      <!-- EMAIL -->

      <mat-card class="p-6 rounded-2xl shadow-md hover:shadow-lg transition">
        <h2
          class="text-xl font-semibold text-center mb-6 text-gray-900 dark:text-gray-200"
        >
          Email
        </h2>

        <form
          [formGroup]="emailForm"
          (ngSubmit)="updateEmail()"
          class="flex flex-col gap-4"
        >
          <mat-form-field appearance="fill" class="w-full">
            <mat-label>Email</mat-label>

            <input matInput formControlName="email" />

            @let email = emailForm.controls.email;

            @if (email?.touched && email?.invalid) {
              <mat-error>
                @switch (true) {
                  @case (email?.errors?.["required"]) {
                    Email is required
                  }

                  @case (email?.errors?.["email"]) {
                    Invalid email address
                  }

                  @case (email?.errors?.["safeEmail"]) {
                    This email domain is not allowed
                  }
                }
              </mat-error>
            }
          </mat-form-field>

          <button
            mat-flat-button
            color="primary"
            type="submit"
            class="rounded-xl shadow-md mt-4 dark:bg-blue-700 dark:text-white"
            [disabled]="emailForm.invalid || isEmailSubmitting"
          >
            Update Email
          </button>
        </form>
      </mat-card>

      <!-- PASSWORD -->

      <mat-card class="p-6 rounded-2xl shadow-md hover:shadow-lg transition">
        <h2
          class="text-xl font-semibold text-center mb-6 text-gray-900 dark:text-gray-200"
        >
          Password
        </h2>

        <form
          [formGroup]="passwordForm"
          (ngSubmit)="updatePassword()"
          class="flex flex-col gap-4"
        >
          <!-- Current -->

          <mat-form-field appearance="fill" class="w-full">
            <mat-label>Current Password</mat-label>

            <input
              matInput
              [type]="hideCurrentPassword ? 'password' : 'text'"
              formControlName="currentPassword"
            />

            <button
              mat-icon-button
              matSuffix
              type="button"
              (click)="hideCurrentPassword = !hideCurrentPassword"
              [attr.aria-label]="'Hide or show password'"
            >
              <mat-icon class="dark:text-gray-200">
                {{ hideCurrentPassword ? "visibility_off" : "visibility" }}
              </mat-icon>
            </button>

            @let password = passwordForm.controls.currentPassword;

            @if (password.touched || password.dirty) {
              <mat-error>
                @switch (true) {
                  @case (password.errors?.["required"]) {
                    Password is required
                  }

                  @case (password.errors?.["weakPassword"]) {
                    Must be at least 12 characters
                  }
                }
              </mat-error>
            }
          </mat-form-field>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- New -->

            <mat-form-field appearance="fill" class="w-full">
              <mat-label>New Password</mat-label>

              <input
                matInput
                [type]="hideNewPassword ? 'password' : 'text'"
                formControlName="newPassword"
              />

              <button
                mat-icon-button
                matSuffix
                type="button"
                (click)="hideNewPassword = !hideNewPassword"
              >
                <mat-icon>
                  {{ hideNewPassword ? "visibility_off" : "visibility" }}
                </mat-icon>
              </button>

              @let newPassword = passwordForm.controls.newPassword;

              @if (newPassword.touched || newPassword.dirty) {
                <mat-error>
                  @switch (true) {
                    @case (newPassword.errors?.["required"]) {
                      Password is required
                    }

                    @case (newPassword.errors?.["weakPassword"]) {
                      Must be at least 12 characters
                    }
                  }
                </mat-error>
              }
            </mat-form-field>

            <!-- Confirm -->

            <mat-form-field appearance="fill" class="w-full">
              <mat-label>Confirm New Password</mat-label>

              <input
                matInput
                [type]="hideConfirmPassword ? 'password' : 'text'"
                formControlName="confirmPassword"
              />

              <button
                mat-icon-button
                matSuffix
                type="button"
                (click)="hideConfirmPassword = !hideConfirmPassword"
              >
                <mat-icon>
                  {{ hideConfirmPassword ? "visibility_off" : "visibility" }}
                </mat-icon>
              </button>

              @let confirm = passwordForm.controls.confirmPassword;
              @let showErrors = confirm.touched || confirm.dirty;

              @if (showErrors) {
                <mat-error>
                  @if (confirm.errors?.["required"]) {
                    Confirmation is required
                  }

                  @if (confirm.errors?.["mismatch"]) {
                    Passwords do not match
                  }
                </mat-error>
              }
            </mat-form-field>
          </div>

          <button
            mat-flat-button
            color="primary"
            type="submit"
            class="rounded-xl shadow-md mt-4 dark:bg-blue-700 dark:text-white"
            [disabled]="passwordForm.invalid || isPasswordSubmitting"
          >
            Change Password
          </button>
        </form>
      </mat-card>
    </div>
  </main>
</div>
